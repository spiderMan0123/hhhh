// App.tsx
import React, { useState, useEffect } from 'react';

const NumberGuessingGame = () => {
  const [target, setTarget] = useState<number>(Math.floor(Math.random() * 100) + 1);
  const [range, setRange] = useState<[number, number]>([1, 100]);
  const [userGuess, setUserGuess] = useState<string>('');
  const [history, setHistory] = useState<number[]>([]);
  const [message, setMessage] = useState<string>('è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—å¼€å§‹æ¸¸æˆ');
  const [gameOver, setGameOver] = useState(false);

  // å¤„ç†ç”¨æˆ·è¾“å…¥
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    const guess = parseInt(userGuess);
    
    if (isNaN(guess)) {
      setMessage('è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—');
      return;
    }

    if (guess < range[0] || guess > range[1]) {
      setMessage(`è¯·è¾“å…¥${range[0]}-${range[1]}ä¹‹é—´çš„æ•°å­—`);
      return;
    }

    // æ£€æŸ¥çŒœæµ‹ç»“æœ
    if (guess === target) {
      setGameOver(true);
      setHistory([...history, guess]);
      setMessage('ğŸ‰ æ­å–œä½ çŒœå¯¹äº†ï¼');
    } else {
      const newRange: [number, number] = 
        guess < target ? [guess + 1, range[1]] : [range[0], guess - 1];
      
      setRange(newRange);
      setHistory([...history, guess]);
      setMessage(guess < target ? 'è¯•è¯•æ›´å¤§çš„æ•°å­— â†‘' : 'è¯•è¯•æ›´å°çš„æ•°å­— â†“');
    }
    
    setUserGuess('');
  };

  // é‡ç½®æ¸¸æˆ
  const restartGame = () => {
    setTarget(Math.floor(Math.random() * 100) + 1);
    setRange([1, 100]);
    setUserGuess('');
    setHistory([]);
    setMessage('è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—å¼€å§‹æ¸¸æˆ');
    setGameOver(false);
  };

  return (
    <div className="game-container p-4 max-w-md mx-auto">
      <h2 className="text-2xl font-bold mb-4 text-blue-600">æ•°å­—çŒœçŒœçœ‹</h2>
      
      <form onSubmit={handleSubmit} className="mb-4">
        <div className="flex gap-2">
          <input
            type="number"
            value={userGuess}
            onChange={(e) => setUserGuess(e.target.value)}
            min={range[0]}
            max={range[1]}
            disabled={gameOver}
            className="flex-1 p-2 border rounded"
            placeholder={`${range[0]}-${range[1]}`}
          />
          <button
            type="submit"
            disabled={gameOver}
            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-400"
          >
            {gameOver ? 'å·²ç»“æŸ' : 'æäº¤'}
          </button>
        </div>
      </form>

      <div className="space-y-2">
        <div className="text-lg font-semibold text-gray-700">{message}</div>
        <div className="text-sm text-gray-600">
          å½“å‰èŒƒå›´ï¼š{range[0]} - {range[1]}
        </div>
        <div className="text-sm">
          çŒœæµ‹è®°å½•ï¼š{history.join(' â†’ ')}
        </div>
      </div>

      {gameOver && (
        <button
          onClick={restartGame}
          className="mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
        >
          é‡æ–°å¼€å§‹
        </button>
      )}
    </div>
  );
};

export default NumberGuessingGame;
